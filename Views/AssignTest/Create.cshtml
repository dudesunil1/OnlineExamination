@model IEnumerable<OnlineExamination.Models.StudentMasterModel>

<div class="card">
    <div class="card-header border-bottom border-gray-100 flex-align gap-8">
        <h5 class="mb-0">Assign Test</h5>
    </div>
    <div class="card-body">
        <div class="row gy-20">
            <div class="col-xxl-12 col-md-12 col-sm-12">
                <div class="row g-20">

                    <!-- Dropdown to select test -->
                    <div class="col-sm-4">
                        <label for="SelectedTest">Select Test:</label>
                        <select id="SelectedTest" class="form-control">
                            <option value="">-- Select Test --</option>
                            @foreach (var item in ViewBag.TestList as List<SelectListItem>)
                            {
                                <option value="@item.Value">@item.Text</option>
                            }
                        </select>
                    </div>

                    <!-- Search Filter -->
                    <div class="col-sm-6">
                        <label for="searchInput">Search:</label>
                        <input type="text" id="searchInput" class="form-control" placeholder="Search students...">
                    </div>

                    <div class="col-sm-6">
                        <label for="searchInput">Search:</label>
                        <div class="d-flex">
                            <button type="button" id="searchButton" class="btn btn-primary ml-2">Submit</button>
                        </div>
                    </div>

                    <!-- Student List -->
                    <div class="col-sm-12">
                        @if (Model == null || !Model.Any())
                        {
                            <div class="alert alert-warning">
                                No Data Found
                            </div>
                        }
                        else
                        {
                            <form id="submitForm" method="post" action="@Url.Action("Submit", "AssignTest")">
                                <table class="table table-striped table-borderless custom-tbl text-center" id="studentTable">
                                    <thead>
                                        <tr>
                                            <th>
                                                <input type="checkbox" id="selectAll" />
                                            </th>
                                            <th>@Html.DisplayNameFor(model => model.FirstOrDefault().Stud_Id)</th>
                                            <th>@Html.DisplayNameFor(model => model.FirstOrDefault().Stud_Name)</th>
                                            <th>@Html.DisplayNameFor(model => model.FirstOrDefault().Stud_Class)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model)
                                        {
                                            <tr>
                                                <td>
                                                    <input type="checkbox" class="studentCheckbox" data-stud-id="@item.Stud_Id" name="selectedStudentIds" value="@item.Stud_Id" />
                                                </td>
                                                <td>@Html.DisplayFor(modelItem => item.Stud_Id)</td>
                                                <td>@Html.DisplayFor(modelItem => item.Stud_Name)</td>
                                                <td>@Html.DisplayFor(modelItem => item.classname)</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>

                                <!-- Hidden field for the selected Test ID -->
                                <input type="hidden" id="SelectedTestId" name="SelectedTestId" />
                            </form>
                        }
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {
        // Select/Deselect all checkboxes
        $('#selectAll').change(function () {
            var isChecked = $(this).prop('checked');
            $('.studentCheckbox').prop('checked', isChecked);
        });

        // Submit Button click
        $('#searchButton').click(function () {
            // Get the selected Test ID
            var selectedTestId = $('#SelectedTest').val();

            // Set the selected Test ID in the hidden input
            $('#SelectedTestId').val(selectedTestId);

            // If no Test is selected, show an alert
            if (selectedTestId === "") {
                alert("Please select a test.");
                return;
            }

            // Get all selected student IDs
            var selectedStudentIds = [];
            $('.studentCheckbox:checked').each(function () {
                selectedStudentIds.push($(this).val());
            });

            // If no student is selected, show an alert
            if (selectedStudentIds.length === 0) {
                alert("Please select at least one student.");
                return;
            }

            // Submit the form
            $('#submitForm').submit();
        });

        // Search functionality to filter students in the table
        $('#searchInput').keyup(function () {
            var searchQuery = $(this).val().toLowerCase();

            // Loop through all table rows and hide those that don't match the search query
            $('#studentTable tbody tr').each(function () {
                var rowText = $(this).text().toLowerCase();

                if (rowText.indexOf(searchQuery) > -1) {
                    $(this).show(); // Show row if it matches the search query
                } else {
                    $(this).hide(); // Hide row if it doesn't match the search query
                }
            });
        });
    });
</script>
